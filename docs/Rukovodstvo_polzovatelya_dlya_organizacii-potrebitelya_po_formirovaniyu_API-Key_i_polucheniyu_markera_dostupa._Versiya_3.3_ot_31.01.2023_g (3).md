# Оглавление {#оглавление .TOC-Heading}

[Таблица изменений [3](#таблица-изменений)](#таблица-изменений)

[Термины и определения
[4](#термины-и-определения)](#термины-и-определения)

[1 Общие сведения [5](#общие-сведения)](#общие-сведения)

[2 Подготовительные работы
[6](#подготовительные-работы)](#подготовительные-работы)

[2.1 Добавление сотрудников в организацию на портале ЕСИА
[6](#добавление-сотрудников-в-организацию-на-портале-есиа)](#добавление-сотрудников-в-организацию-на-портале-есиа)

[3 Выдача потребителем в ЛК ЮЛ ЕСИА доверенностей сотрудникам на
полномочие вендора на право формирования API-Key
[9](#выдача-потребителем-в-лк-юл-есиа-доверенностей-сотрудникам-на-полномочие-вендора-на-право-формирования-api-key)](#выдача-потребителем-в-лк-юл-есиа-доверенностей-сотрудникам-на-полномочие-вендора-на-право-формирования-api-key)

[3.1 Выдача организации в ЛК ЮЛ ЕСИА доверенностей сотрудникам на право
формирования API-Key на свою организацию
[11](#выдача-организацией-в-лк-юл-есиа-доверенностей-сотрудникам-на-право-формирования-api-key-на-свою-организацию)](#выдача-организацией-в-лк-юл-есиа-доверенностей-сотрудникам-на-право-формирования-api-key-на-свою-организацию)

[3.2 Выдача доверенности
[11](#выдача-доверенности)](#выдача-доверенности)

[4 Формирование сотрудником организации-потребителя API-Key в ЛК ИЭП
[18](#формирование-сотрудником-организации-потребителя-api-key-в-лк-иэп)](#формирование-сотрудником-организации-потребителя-api-key-в-лк-иэп)

[5 Получение приложением потребителя маркера доступа к API услуг ЕПГУ в
обмен на API-Key
[21](#получение-приложением-потребителя-маркера-доступа-к-api-услуг-епгу-в-обмен-на-api-key)](#получение-приложением-потребителя-маркера-доступа-к-api-услуг-епгу-в-обмен-на-api-key)

[6 Краткое описание использования полученного маркера доступа в запросах
к API услуг ЕПГУ
[22](#краткое-описание-использования-полученного-маркера-доступа-в-запросах-к-api-услуг-епгу)](#краткое-описание-использования-полученного-маркера-доступа-в-запросах-к-api-услуг-епгу)

[7 Ссылки на документы [23](#ссылки-на-документы)](#ссылки-на-документы)

# Таблица изменений {#таблица-изменений .unnumbered}

+------+---------+--------------+--------------------------------------+
| **   | *       | **Автор**    | **Изменение**                        |
| Верс | *Дата** |              |                                      |
| ия** |         |              |                                      |
+======+=========+==============+======================================+
| 1.0  | --      | --           | Документ создан                      |
+------+---------+--------------+--------------------------------------+
| 2.0  | 09.     | Ларина Н.В.  | -   Удален раздел 2.1                |
|      | 03.2022 |              |     Подготовительные работы со       |
|      |         |              |     стороны СЭ ЕСИА (не актуально)   |
|      |         |              |                                      |
|      |         |              | -   Исправлена ссылка на доступ к    |
|      |         |              |     порталу                          |
|      |         |              |                                      |
|      |         |              | -   Добавлен раздел Выдача           |
|      |         |              |     организации в ЛК ЮЛ ЕСИА         |
|      |         |              |     доверенностей сотрудникам на     |
|      |         |              |     право формирования API-Key на    |
|      |         |              |     свою организацию                 |
|      |         |              |                                      |
|      |         |              | -   Актуализированы ссылки на        |
|      |         |              |     продуктовую и тестовую среды     |
+------+---------+--------------+--------------------------------------+
| 2.1  | 11.     | Ларина Н.В.  | Добавлено описание формата поля      |
|      | 03.2022 |              | signature в п.5                      |
+------+---------+--------------+--------------------------------------+
| 2.2  | 22.     | Ларина Н.В.  | Уточнена кодировка в п.5 (было:      |
|      | 03.2022 |              | Base64, стало: urlSafeBase64)        |
+------+---------+--------------+--------------------------------------+
| 3.0  | 21.     | Цирихов А.М. | Массовые изменения с учётом          |
|      | 07.2022 |              | последних доработок и                |
|      |         |              | пользовательского опыта              |
+------+---------+--------------+--------------------------------------+
| 3.1  | 25.     | Клин Р.Л.    | Заменен рисунок 20 с учетом версии   |
|      | 07.2022 |              | 1.5 Спецификации API ЕПГУ            |
+------+---------+--------------+--------------------------------------+
| 3.2  | 13.     | Маламут А.Ю. | -   В раздел Общие сведения          |
|      | 10.2022 |              |     добавлена уточненная информация  |
|      |         |              |     по сертификатам, используемым в  |
|      |         |              |     механизме API-KEY;               |
|      |         |              |                                      |
|      |         |              | -   В разделе Подготовительные       |
|      |         |              |     работы уточнен список УЦ         |
+------+---------+--------------+--------------------------------------+
| 3.3  | 31.     | Трубников    | Обновлены рисунки в разделах 2.1, 3  |
|      | 01.2023 | А.Л          | и 4                                  |
+------+---------+--------------+--------------------------------------+

# Термины и определения {#термины-и-определения .unnumbered}

+-------------------------+--------------------------------------------+
| **Термин / сокращение** | **Определение**                            |
+=========================+============================================+
| API-KEY                 | > Ключ -- уникальный идентификатор типа    |
|                         | > UUID, дающий право представителю         |
|                         | > организации, получившему данный ключ,    |
|                         | > получения маркера доступа (access token) |
|                         | > ЕСИА к API услуг ЕПГУ                    |
+-------------------------+--------------------------------------------+
| Организация-вендор      | > Организация-разработчик ПО,              |
|                         | > предоставляющая организации-потребителю  |
|                         | > полномочие на получение API-KEY          |
+-------------------------+--------------------------------------------+
| ВИС                     | > Внешняя информационная система           |
+-------------------------+--------------------------------------------+
| ЕПГУ                    | > Единый портал государственных услуг      |
+-------------------------+--------------------------------------------+
| ЕСИА                    | > Единая система идентификации и           |
|                         | > аутентификации                           |
+-------------------------+--------------------------------------------+
| ИС                      | > Информационная система                   |
+-------------------------+--------------------------------------------+
| ИЭП                     | > Инфраструктура электронного              |
|                         | > правительства                            |
+-------------------------+--------------------------------------------+
| КЭП                     | > Квалифицированная электронная подпись    |
+-------------------------+--------------------------------------------+
| ЛК                      | > Личный кабинет                           |
+-------------------------+--------------------------------------------+
| Организация-потребитель | > Организация, получающая полномочие от    |
|                         | > организации-вендора на формирование      |
|                         | > API-KEY                                  |
+-------------------------+--------------------------------------------+
| РП                      | > Руководство пользователя                 |
+-------------------------+--------------------------------------------+
| УЦ                      | > Удостоверяющий центр                     |
+-------------------------+--------------------------------------------+
| ФЛ                      | > Физическое лицо                          |
+-------------------------+--------------------------------------------+
| ФК                      | > Федеральное казначейство                 |
+-------------------------+--------------------------------------------+
| ФНС                     | > Федеральная налоговая служба             |
+-------------------------+--------------------------------------------+
| ЦБ                      | > Центральный банк                         |
+-------------------------+--------------------------------------------+
| ЮЛ                      | > Юридическое лицо                         |
+-------------------------+--------------------------------------------+

# Общие сведения

Для упрощения применения в нативных приложениях сторонних разработчиков
механизма аутентификации пользователей в ЕСИА для доступа к API услуг
ЕПГУ в сервисе авторизации ЕСИА реализована схема аутентификации,
основанная на формировании идентификационного ключа ЕСИА в ЛК ИЭП
уполномоченного сотрудника организации.

Для обеспечения доступа нативных приложений сторонних разработчиков к
API услуг ЕПГУ разработан набор сервисов ЕСИА, которые обеспечивают:

-   Предоставление нативному приложению access-токена для обращения к
    методам API услуг ЕПГУ, однозначно идентифицирующего:

    -   пользователя приложения - по OID учётной записи этого
        пользователя в ЕСИА;

    -   типа приложения - по мнемонике - CLIENT_ID - информационной
        системы организации-вендора, от имени которой работает
        приложение данного типа.

[Примечание]{.underline}: в ЕСИА должна быть зарегистрирована
организация-вендор приложения, создана информационная система этой
организации-вендора.

-   Выдачу нативному приложению указанного access-токена с помощью
    нового метода REST API ЕСИА, получающего на вход:

    -   идентификационный ключ (API-KEY);

    -   подпись передаваемого идентификационного ключа сертификатом ЭП
        сотрудника организации-потребителя нативного приложения или
        обезличенным сертификатом организации. Нельзя использовать
        сертификат без данных организации.

[Примечание]{.underline}: указанный метод REST API ЕСИА для формирования
и выдачи приложению access-токена доступа к API услуг ЕПГУ доступен за
пределами внешнего контура ИЭП, т.е., типа public.

-   Предоставление организациям-потребителям нативных приложений сервиса
    в ЛК ИЭП, использующего набор методов REST API ЕСИА, обеспечивающих:

    -   предоставление перечня ИС организаций-вендоров, которые
        предоставили данной организации-потребителю полномочие на право
        выдачи доверенностей своим пользователям на формирование
        идентификационных ключей, привязанных к этой ИС
        организации-вендора;

    -   управление идентификационными ключами (создание, удаление,
        блокировка).

# Подготовительные работы

Самостоятельные подготовительные работы со стороны потребителя:

1.  Получить в уполномоченном аккредитованном УЦ (например, ФНС, ЦБ, ФК)
    КЭП руководителя организации-потребителя.

2.  Зарегистрировать в ЕСИА подтверждённую УЗ руководителя
    организации-потребителя (для самостоятельного подтверждения УЗ можно
    использовать полученную КЭП руководителя организации-потребителя),
    см. подраздел 3.1.3 документа «ЕСИА. Руководство пользователя»

3.  Руководителю организации, используя свою подтверждённую УЗ в ЕСИА и
    КЭП руководителя организации, зарегистрировать в ЕСИА
    организацию-потребитель (см. подраздел 3.2 документа «ЕСИА.
    Руководство пользователя»).

4.  При необходимости (если их ещё нет в ЕСИА) зарегистрировать в ЕСИА
    подтверждённые УЗ будущих сотрудников организации-потребителя (2 или
    более) см. подраздел 2.1.

## Добавление сотрудников в организацию на портале ЕСИА

Для добавления сотрудников в организацию необходимо выполнить следующие
действия (см. документ «ЕСИА. Руководство пользователя» подраздел
3.5.2.3):

1.  Авторизоваться в ЛК ЕСИА с выбором роли руководителя
    организации-потребителя по ссылке:

    1.  ссылка на тестовой среде:
        <https://esia-portal1.test.gosuslugi.ru>

    2.  ссылка на продуктивной среде: <https://esia.gosuslugi.ru>

2.  Перейти на вкладку «Организации» (Рисунок 1).

3.  Выбрать организацию.

4.  Выбрать раздел «Сотрудники» (Рисунок 1).

5.  Нажать кнопку «Пригласить сотрудника» (Рисунок 1).

6.  В отобразившейся форме указать данные сотрудника и нажать на кнопку
    «Пригласить» (Рисунок 2).

![](media/image1.png){width="5.9006944444444445in"
height="8.763194444444444in"}

Рисунок 1 -- Раздел «Сотрудники» ЛК ЕСИА

![](media/image2.png){width="5.9006944444444445in"
height="6.292361111111111in"}

Рисунок 2 -- Форма добавления сотрудника

# Выдача потребителем в ЛК ЮЛ ЕСИА доверенностей сотрудникам на полномочие вендора на право формирования API-Key 

Для выдачи доверенностей сотрудникам на полномочие вендора на право
формирования API-Key руководителю организации-потребителя в ЛК ЮЛ ЕСИА
необходимо выполнить следующий действия:

1.  Выдать с подписью КЭП руководителя своему сотруднику, ответственному
    за формирование идентификационных ключей (API-Key), доверенность на
    доступное ему полномочие на право выдачи доверенностей на
    формирование идентификационных ключей (см.п.3.1).

2.  Выдать права администратора профиля организации и включить в группу
    доступа \"Технологический портал\" (ЕСИА) сотрудника, ответственного
    за формирование идентификационных ключей (API-Key). Для этого:

    1.  Авторизоваться в ЛК ЕСИА с выбором роли руководителя
        организации-потребителя по ссылке:

        1.  ссылка на тестовой среде:
            <https://esia-portal1.test.gosuslugi.ru>

        2.  ссылка на продуктивной среде: <https://esia.gosuslugi.ru>

    2.  Перейти в ЛК ИЭП. ЛК ИЭП доступен по следующим ссылкам:

        1.  ссылка на тестовой среде:
            <https://svcdev-partners.test.gosuslugi.ru/>

        2.  ссылка на продуктивной среде:
            <https://partners.gosuslugi.ru>

    3.  Только для тестовой среды - установить в настройках браузера
        cookies **new-partners=1** и **access_poweratt=1** для домена
        **.gosuslugi.ru --** эту операцию можно выполнить также с
        помощью JS-скрипта, запущенного из консоли веб-браузера:

document.cookie=\"access_poweratt=1; path=/; domain=.gosuslugi.ru;
secure\";

document.cookie=\"new-partners=1; path=/; domain=.gosuslugi.ru;
secure\";

4.  Перейти на вкладку «Организации».

5.  Выбрать организацию.

6.  Выбрать раздел «Доверенности и доступы» (Рисунок 3).

7.  Нажать на ссылку «Единая система идентификации и аутентификации»
    (Рисунок 3).

8.  Перейти в группу «Технологический портал» (Рисунок 4).

9.  Нажать ссылку «Присоединить нового сотрудника» (Рисунок 4).

10. Указать ФИО сотрудника и нажать на кнопку «Добавить» (Рисунок 6).

11. Повторить перечисленные выше действия для группы «Администраторы
    профиля организации» (Рисунок 5).

![](media/image3.png){width="5.9006944444444445in"
height="5.591666666666667in"}

Рисунок 3 -- Раздел «Доверенности и доступы» ЛК ЕСИА

![](media/image4.png){width="5.9006944444444445in"
height="1.5041666666666667in"}

Рисунок 4 -- Группа «Технологический портал»

![](media/image5.png){width="5.9006944444444445in"
height="1.6659722222222222in"}

Рисунок 5 -- Группа «Администраторы профиля организации»

![](media/image6.png){width="5.9006944444444445in"
height="3.3715277777777777in"}

Рисунок 6 -- Форма редактирования участников группы

## Выдача организацией в ЛК ЮЛ ЕСИА доверенностей сотрудникам на право формирования API-Key на свою организацию

Для выдачи доверенностей на право формирования API-Key сотрудникам
организации руководителю в ЛК ЮЛ ЕСИА необходимо выполнить следующие
действия:

1.  Авторизоваться в ЛК ИЭП под руководителем организации после перехода
    по ссылке:

    1.  ссылка на тестовой среде:
        <https://svcdev-partners.test.gosuslugi.ru/>

    2.  ссылка на продуктивной среде: <https://partners.gosuslugi.ru>

2.  Только для тестовой среды -- установить в настройках браузера
    cookies **new-partners=1** и **access_poweratt=1** для домена
    **.gosuslugi.ru --** эту операцию можно выполнить также с помощью
    JS-скрипта, запущенного из консоли веб-браузера:

document.cookie=\"access_poweratt=1; path=/; domain=.gosuslugi.ru;
secure\";

document.cookie=\"new-partners=1; path=/; domain=.gosuslugi.ru;
secure\";

## Выдача доверенности 

Для выдачи доверенности необходимо выполнить следующие действия:

1.  На странице «Доверенности» закладки «Делегирование полномочий» ЛК ЮЛ
    ЕСИА нажать кнопку «Создать новую» (**Рисунок 7**). После нажатия
    кнопки отобразится форма создания доверенности (**Рисунок 8**).

2.  Выбрать тип доверенного лица: «Сотрудник» или «Частное лицо».
    Независимо от выбора «Сотрудник» или «Частное лицо» доверенность
    будет создана ЮЛ для ФЛ.

    1.  Если выбран вариант «Сотрудник», то необходимо выбрать
        конкретного сотрудника из выпадающего списка (**Рисунок 9**), в
        котором отображены сотрудники организации. Для редактирования
        списка сотрудников необходимо нажать на ссылку «Сотрудники».

    2.  Если выбран вариант «Частное лицо», то необходимо в открывшейся
        форме (**Рисунок 10**) указать данные ФЛ, зарегистрированного в
        ЕСИА. Все поля являются обязательными для заполнения. После того
        как все данные заполнены - необходимо нажать на кнопку
        «Сохранить» для осуществления поиска гражданина. Если гражданин
        не найден - необходимо проверить правильность ввода данных и
        повторить попытку.

3.  Выбрать доверяемые действия (полномочия):

    1.  Нажать на ссылку «Выбрать». Отобразится форма (**Рисунок 11**)
        на которой необходимо отметить действия (полномочия), на которые
        необходимо выдать доверенность. Для каждого действия доступна
        ссылка «Подробнее», позволяющая просмотреть подробную информацию
        о полномочии.

    2.  После того как все необходимые действия будут отмечены
        необходимо нажать на кнопку «Сохранить».

4.  Выбрать срок действия доверенности.

5.  Нажать на кнопку «Создать». Отобразится форма Подписания
    доверенности (**Рисунок 12**). При необходимости можно просмотреть
    доверенность в формате XML (**Рисунок 13**). Данный формат
    предоставляется для ознакомления в соответствии с требованием ст. 12
    Закона об электронной подписи (№ 63-ФЗ от 06.04.2011).

6.  Нажать на кнопку «Подписать» и выполнить подписание доверенности КЭП
    (**Рисунок 14**).

7.  После выдачи доверенности она отобразится в статусе «Новая».

![](media/image7.png){width="5.9006944444444445in" height="3.425in"}

Рисунок 7 -- Форма с кнопкой создания новой доверенности.

![](media/image8.png){width="6.02992125984252in"
height="5.753158355205599in"}

**Рисунок 8 -- Форма создания доверенности**

![](media/image9.png){width="5.9006944444444445in"
height="2.5569444444444445in"}

Рисунок 9 - Выпадающий список для выбора сотрудника

![](media/image10.png){width="5.8069444444444445in"
height="9.620833333333334in"}

Рисунок 10 - Форма указания данных частного лица

![](media/image11.png){width="5.9006944444444445in"
height="2.127083333333333in"}

Рисунок 11 -- Форма выбора полномочий

![](media/image12.png){width="5.9006944444444445in" height="6.23125in"}

Рисунок 12 -- Форма подписания доверенности

![](media/image13.png){width="5.9006944444444445in"
height="7.8902777777777775in"}

Рисунок 13 -- Электронная форма доверенности

![](media/image14.png){width="4.665660542432196in"
height="2.6210575240594927in"}

**Рисунок 14 -- Окно ввода пин-кода для сертификата ЭП**

# Формирование сотрудником организации-потребителя API-Key в ЛК ИЭП

Сотрудник организации-потребителя, ответственный за формирование
идентификационных ключей должен сформировать идентификационные ключи на
сотрудников своей организации на доступной ему для формирования API-Key
ИС организации-вендора. Для этого необходимо:

1.  Авторизоваться в ЛК ИЭП, осуществив переход по ссылке:

    1.  ссылка на тестовой среде:
        <https://svcdev-partners.test.gosuslugi.ru/>

    2.  ссылка на продуктивной среде: <https://partners.gosuslugi.ru>

2.  Только для тестовой среды -- установить в настройках браузера
    cookies **new-partners=1** и **access_poweratt=1** для домена
    **.gosuslugi.ru --** эту операцию можно выполнить также с помощью
    JS-скрипта, запущенного из консоли веб-браузера:

> document.cookie=\"access_poweratt=1; path=/; domain=.gosuslugi.ru;
> secure\";
>
> document.cookie=\"new-partners=1; path=/; domain=.gosuslugi.ru;
> secure\";

3.  Перейти во вкладку «Мои системы» (Рисунок 15).

4.  Нажать на название системы.

5.  Нажать кнопку «Добавить сотрудника» (Рисунок 16).

6.  Указать в поисковой строке ФИО сотрудника (Рисунок 17).

7.  Выбрать необходимого сотрудника из выпадающего списка (Рисунок 18).

8.  Нажать кнопку «Добавить».

9.  Добавленные сотрудники и список сформированных ключей отображаются
    на странице информационной системы (Рисунок 19).

![](media/image15.png){width="5.733333333333333in"
height="4.391666666666667in"}

Рисунок 15 -- Вкладка «Мои системы»

![](media/image16.png){width="5.741666666666666in"
height="2.8833333333333333in"}

Рисунок 16 - Кнопка добавления нового сотрудника

![](media/image17.png){width="4.755191382327209in"
height="1.8535553368328959in"}

Рисунок 17 - Поисковая строка

![](media/image18.png){width="4.853427384076991in"
height="1.8531266404199476in"}

Рисунок 18 - Выпадающий список

![](media/image19.png){width="5.808333333333334in"
height="3.658333333333333in"}

Рисунок 19 -- Список сотрудников

# Получение приложением потребителя маркера доступа к API услуг ЕПГУ в обмен на API-Key 

Для получения приложением потребителя маркера доступа к API услуг ЕПГУ в
обмен на API-Key необходимо сделать запрос к REST API ЕСИА согласно
описанию, приведенном в Приложении «Б.12 Сервис получения маркера
доступа по идентификационному ключу» документа «ЕСИА. Методические
рекомендации по использованию Единой системы идентификации и
аутентификации».

Описание структуры полученного маркера доступа ЕСИА приведено там же в
Приложении «В.5 Сведения о структуре и проверке маркера доступа»
методических рекомендаций по использованию ЕСИА - копия раздела для
удобства приведена в разделе «Приложения» данного документа.

# Краткое описание использования полученного маркера доступа в запросах к API услуг ЕПГУ

Описание REST API интерфейса приведено в документе «Спецификация API
ЕПГУ». Схема использования маркера доступа на примере подачи заявления
представлена на рисунке (Рисунок 20).

![](media/image20.emf){width="4.287175196850393in"
height="7.291666666666667in"}

Рисунок 20 -- Схема получения маркера доступа на примере подачи
заявления.

# Ссылки на документы

+----------------------------------+-----------------------------------+
| **Документ**                     | **Ссылка**                        |
+==================================+===================================+
| ЕСИА. Руководство пользователя   | Размещён по адресу:               |
|                                  |                                   |
|                                  | <https://pa                       |
|                                  | rtners.gosuslugi.ru/catalog/esia> |
+----------------------------------+-----------------------------------+
| Руководство пользователя         | Размещен по адресу:               |
| технологического портала ЕСИА    |                                   |
|                                  | <https://d                        |
|                                  | igital.gov.ru/ru/documents/6190/> |
+----------------------------------+-----------------------------------+
| ЕСИА. Методические рекомендации  | Размещён по адресу:               |
| по использованию Единой системы  |                                   |
| идентификации и аутентификации   | <https://d                        |
|                                  | igital.gov.ru/ru/documents/6186/> |
+----------------------------------+-----------------------------------+
| Спецификация API ЕПГУ            | Размещён по адресу:               |
|                                  |                                   |
|                                  | https://partner                   |
|                                  | s.gosuslugi.ru/catalog/api_for_gu |
+----------------------------------+-----------------------------------+
